# How to implement generics

- IRPass transforms ASTStructDeclaration, ASTFunctionDeclaration into IRStructTemplate, IRFunctionTemplate
- IRStructTemplate, IRFunctionTemplate are instantiated and IRStruct, IRFunction are created
- IRStruct, IRFunction save which template they were created from
- Only one instantiation can exist for a set of type parameters
- Only instantiated functions are generated by CodegenPass

## IRPass
- For every declaration
    - When entering scope, add type params to environment as generic

## SemanticPass
- Struct expressions
    - For every field:
        - Check if a matching field exists in the struct type
        - If the field in the struct type is generic
            - Check if the generic param can be deduced from the given value
- Function calls
    - Query functions by name first
    - For every found function
        - For every parameter
            - Check if parameter matches with arg
            - If parameter is generic
                - Check if type parameter for parameter can be deduced from arg

## GenericLoweringPass
- Transform all instantiations of generic functions
- For every instantiation of a generic function
    - Replace all instances of a generic type with the specified concrete type

```flat
struct GenericStruct<T> {
    a: vec<T>
}

let f = GenericStruct {
    a: getVecI32(), // a: vec<i32> => T: i32
}

```